成本定义
===

概述
---

iDempiere财务支持：
1. 成本类型：标准成本/实际成本
2. 计价方法：**标准成本/采购价格移动平均（其他方式现在不支持）**

成本核算原理：
1. 基于产品的计算，材料成本可由核算方法依业务单据自动算出。
2. 基于库存组织的成本数据结构。
3. 成本要素汇总

常见问题
---

1. 新建单据时，过账错误 (Resubmit - No Costs for 某某产品)
在源码中搜索No Costs for得知该错误出现在如下单据：
M_inout
M_inventory
M_MatchPO
M_Production
如果该产品的成本表无成本记录或者成本为0，则报错导致无法过账。
解决办法：
1.【绩效管理】-【成本】-【创建成本记录】新建该产品的成本记录
2. 更新产品成本。
2.1 如果标准成本，
2.2 如果平均成本，

2. 新账导入库存时候，报错：无成本记录
导入库存，系统将同时过账，如果无成本记录，系统将无法记账。
https://groups.google.com/d/topic/idempiere/HdV0GG_5O1M/discussion

成本设置
---

设置流程
标准成本 -->   -->  -->   -->  -->   -->
平均成本  -->   -->  -->   -->  -->   -->

【绩效管理】-【财务规则】-【财务模式】：成本计价、成本类型、成本核算层
【绩效管理】-【财务规则】-【财务维度】：成本中心、作业、市场活动等
【绩效管理】-【财务规则】-【作业ABC】：作业
【物料管理】-【物料规则】-【产品类型】-【账务】：计价方法、成本
【绩效管理】-【成本】：成本类型、成本要素、产品成本维护

> 1. 成本核算层（Costing level）决定了成本的共享层次，比如Client级别可以允许组织间共享标准成本。
> 2. 产品类别的成本设置有更高的优先级别。

![账务模式](http://static.oschina.net/uploads/space/2016/0425/235723_7ae0_2720480.png)

![成本菜单](http://static.oschina.net/uploads/space/2016/0425/235748_TNhK_2720480.png)

成本类型
---

【绩效管理】-【成本】-【成本类型】：只用在“财务模式”中。
你还可以设置“定额”“年度”“模拟”等其他类型，以利于不同的账套使用。比如：
- 标准成本（Standard Cost or Frozen Cost）：通常半年或者一年之内不会变化。
- 现行标准成本（Current Standard Cost）：即定额成本，可定期调整。
- 模拟成本（Simulated Cost）：即建议成本，可更新标准成本。
- 实际成本（Cost）：单据发生成本。
- 平均成本（Avg Cost）：采购价格移动加权平均

> 需测试：标准成本内置的成本类型为冻结，平均成本内置的类型为平均。

成本要素
---

【绩效管理】-【成本】-【成本要素】：新建成本要素。
1. 成本类型：系统提供5个成本要素类型，用户可根据自己情况定义。
  - 材料Material：材料成本，通常是BOM最底层的组件的直接采购成本。
  - 材料间接费Material Overhead：材料料的间接管理费，比如到厂前的运费、装卸费用、到厂后的保存维护费用。
  - 资源Resource：直接制造成本，通常指直接消耗的人工、设备、场地、杂项费用。
  - 外协费用Outside Processing：委外加工费，可与产品关联以便通过采购接收管理。
  - 制造费用Overhead：资源消耗和外协处理过程中的间接管理费用。
2. 计价方式：可指定成本的计价方式。

iDempiere系统中，任何维度（产品/项目/作业/市场活动）的成本核算等于上述五项成本要素类型的总和。

> ###成本类型和要素规则
> 一个账套只能有一个成本类型，对于成本类型的定义，可以：
> 1. by 时间：比如“过去”，“现在”，“将来”
> 2. by 用途：比如“管理”，“财务”，“测试”
> 
> 一个成本类型下，不能包含与账套计价方式冲突的成本计价
> 1. 比如，账套=标准成本，成本类型随便（=当前财务）
> 2. 成本要素不能定义，材料--移动平均，否则，成本合计将重复计入2次成本。
> 3. 那么也就是，一个账套不允许多个产品组计价方式，比如，原材料组=标准成本，产品组=移动平均
> 4. 当产品相关单据过账时，成本引擎会按照账套的成本要素清单，来计算所有成本值。

产品成本维护
---

【绩效管理】-【成本】-【产品成本】： 只能设置预计成本Future cost。

创建成本记录
---

【绩效管理】-【成本】-【创建成本记录】：某些产品没有成本记录将导致单据无法过账。

由于进货的时间点和立帐(因进货产生的 A/P)时间点可能会不一样，某些ERP系统（iDempiere）采取以进货单作为计算材料成本的依据，而某些ERP 系统则是采以A/P 成立后以应付账款作为成本计算依据。
因此不同的 ERP 系统可能在成本计算的起始时点就有差异，若企业同时采用了不同的ERP系统(例如换ERP系统)，在并行阶段就会发生成本有差异的现象，因此若身为成本会计人员在面临 ERP 系统转换或并行时要先了解二套系统在成本算上的差异，避免对于因为系统本身设计逻辑差异算出不同成本作出错误的解读。


> ###注意：
> 不要通过库存导入产生成本数据，正确方法是：新建一个期初采购订单导入成本。
> https://groups.google.com/d/msg/idempiere/vy0LUFV3e8g/2XGp5dk_BZAJ

![导入成本](http://static.oschina.net/uploads/space/2016/0505/235542_TFU5_2720480.png)

标准成本更新
---

【绩效管理】-【成本】-【成本记录更新】：可指定成本来源，更新到标准成本，并产生成本调整单（会计分录）。

![标准成本更新](http://static.oschina.net/uploads/space/2016/0427/002157_FzGq_2720480.png)

BOM成本累加
---

【生产管理】-【BOM成本累加】：更新标准成本后，重算每个BOM产品的成本。

产品成本报表
---

【绩效管理】-【成本】：可查看3个产品成本报表。
- 产品成本：可选成本账套，成本类型，产品类型，成本要素
- 产品成本汇总：可选成本账套，产品类型
- 产品发票成本明细：可选成本账套，产品类型

