收款业务
===

概述
---

新增收款单，并分配到发票，将立即改变客户的应收账款。
如果收款未分配，付款只改变客户的未结余额(open balance)而不改变账龄的应收金额。

用户可以：
1. 手工新增收款
2. 分配发票到收款

`A. 收款的分录为：`
                      |       借       |       贷        |   备注
在途资金        |        x        |                  |   B_InTransit_Acct
未分配付款     |                 |        x         |  B_UnallocatedCash_Acct        （过渡科目）

`B. 预收款的分录为：`
                      |       借       |       贷        |   备注
在途资金        |        x        |                  |  B_InTransit_Acct       
客户预收款     |                 |         x        |  V_Prepayment_Acct

`C. 发票分配到收款的分录为：`
                      |       借       |       贷        |   备注
未分配付款     |        x        |                  |   B_UnallocatedCash_Acct      （过渡科目）
应收账款        |                  |        x        |   C_Receivable_Acct


收款单据的指示字段：
1. Recipt：表示收款。
2. Prepayment：表示预收款。
3. Over/Under Payment：Over表示“未分配到发票”，Under表示“分期付款”
4. Pay Schedule valid：分期付款标识
5. Allocated：表示已分配到发票
6. Reconciled：表示已被银行对账单核销

定金收款
---

1. 【未清项】-【支付】
2. 直接输入金额，不分配合同，不分配发票。
3. 保存，过账分录A。
4. 等开了发票，再分配，分配结果在“分配allocation”页签查看。

预收款
---

1. 【未清项】-【支付】
2. 选择销售合同，收款自动标记为“预收款”。
3. 保存，过账分录B。

退款
---

**需测试**
1. 某笔定金或者预付款1000元需要退款200元。
2. 未开票，部分(或者全额)退款。直接做一笔付款200元。
4. 已开票1000元，无需退票。作废发票，重做800发票并分配，再做一笔付款200元。
5. 已开票1000元，需退票200。做“贷项通知单”，再对贷项通知单收款-200元。

注：对于贷项通知单的冲减，是无法关联原发票的，只能作为单独的负值发票处理。**我是没有找到关联办法**

发票收款
---

1. 【未清项】-【支付】
2. 选择AR收款，选择已开的发票
3. 如果是一个发票，直接在表头区选择。如果多个发票，在分配Allocate页签选择。
4. 已分配Allocation页签，显示收款已经分配的发票。
5. 保存，过账分录C。
6. 如果收款金额已分配完成，收款窗口字段显示“Allocated”,否则表示该笔收款还有余额，但是余额没有显示，在“收款分配界面”有显示。
7. 如果收款与发票分配关系错误，可以通过【未清项】-【重置分配】删除分配记录。

注意：如果收款金额修改过，分配allocate的收款描述可能因此显示错误金额。

发票分配
---

1. 【未清项】-【收款分配】
2. 选择BP，点击搜索，上面是未分配（未清）的收款记录，下面是未收款的的销售发票。
3. 将收款金额改成发票总额。
4. 点击运行，左下角出现分配单据号，弹出窗口可以查看分配结果。
5. 查看【已分配收款Allocation】，可看到过账分录C。

> ###当有1000个客户预收款，然后开票后分配，工作量太大，怎么办？
> 选择“自动分配”，由于预付款只有供应商信息，可能有合同和发票信息。其自动分配原则为：
> 1. 支付单据中带入的发票参考编号（在BP中定义，可在order，invoice单据中修改，比如可以是电子流水号或者交易号）
> 2. 支付单据中选择的“合同”或者“发票”。
> 3. 商业伙伴余额。
> 4. 发票和付款金额的精确匹配。
> 5. 可选的，你还可以选择按发票时间来分配支付。

发票核销
---

iDempiere没有“发票核销（Apply）”的功能。
对于发票的收款情况（Apply）是通过“分配”来查看的。

对于贷项通知单的冲减，也是无法关联原发票的，只能作为单独的负值发票处理。**我是没有找到关联办法**

坏账处理
---

1. 【未清项】-【坏账处理】：发票将标记为“已付”，该项应付金额将被注销。
2. 选择供应商、发票和坏账额度，银行帐号。
3. 可选择模拟生成结果。

批量收款
---

通用用于费用发票或者支付组。
1. 【未清项】-【支付批Payment into Batch】
2. 新建记录，选择AR收款。
3. 拷贝支付明细行，点击“关闭Close”
4. 业务标记为“Processed已处理”。
5. 新建银行对账单，拷贝支付批记录，一次对多个收款进行对账。

客户关系
---

1. 【合作伙伴】-【合作伙伴规则】-【客户关系】
2. 如果a是个人，AAA是大公司，AAA可以替a支付发票款。那么客户a的代理是AAA。
3. 收到款，匹配发票时候，选择AAA，可以带出a的发票一起支付。

账龄
---

1. 【未清项】-【账龄】

催款信
---

1. 【合作伙伴】-【合作伙伴规则】-【催款】：定义催款等级
2. 【未清项】-【催款信】：先新建一个等级运算，运行生成催款信，打印催款信。

零付款
---

为了标识贷项通知单的付款状态。

虚拟付款
---

虚拟银行，进行非货币交易，比如”背书“。

交叉货币付款
---

你试下看看。

