期初建账
===

> ###默认企业背景
> 1. 中国传统工业企业，单法律实体。
> 2. 财务部门配置：主管、会计、出纳。
> 3. 财务管理目标：业务自动化、报表及时。
> 4. 核算维度：部门、科目、商业伙伴、项目、事务组织。
> 5. 初次建账：新组建企业。
> 6. 系统迁移：已有财务系统应用。

> ###危险提示
> 1. 不要使用工具直接操作后台数据库。
> 2. 不要在上线前破坏所有准备的财务数据归档和备份。

概述
---

需要考虑：
- 您以前的财务管理是如何实现的？
- 您希望iDempiere财务能实现什么功能？
- 您财务部门的管理目标和难点是什么？
- 您预计的实施周期和成本是多少？

可能问题：
- 以前的单据只导入余额是无法查询原始单据的。无解，除非导入明细。
- 未完成单据无记账日期导致iDempiere无法起算账龄。

建账步骤：
1. 根据iDempiere默认推荐设计好科目表。
2. 确认现有科目到iDempiere科目表的对应。
3. 确认已完成单据的科目余额。
4. 整理未完成单据的科目余额。
5. 导入已完成单据的科目余额。
6. 输入未完成单据到iD系统。
7. 试算期初平衡表。

参考：
- http://wiki.adempiere.net/index.php/Opening_Balances_Form
- http://wiki.idempiere.org/en/Establish_Opening_Balances
- http://www.chuckboecking.com/new-trial-balance-window-idempiere-adempiere-open-source-erp/
- http://wiki.openbravo.com/wiki/How_to_initialize_financial_balances_in_Openbravo
- http://blog.vsharing.com/SAP100/A1664729.html SAP开帐

文中提到初始化的单据为：
1. 暂估入库
2. 试算平衡表
3. 未清AR发票
4. 未匹配的AR收款
5. 未清AP发票
6. 未分配的AP付款
7. 已确认的收/付款：已匹配/已分配发票，但银行未清的收付款核销。
8. 存货估价

建账策略
---

1. 先完成所有基准资料的输入，参考[基础资料@](http://idempiere_guide_fi.mydoc.io?v=${version}&t=79149)  和[会计规则@](http://idempiere_guide_fi.mydoc.io?v=${version}&t=79148) 。
2. 确定某个建账月，确认上期期末数据，在建账月初确定初始值，月中并行运行，月末试算平衡表。
3. 建账月初，按模块准备所有相关期初资料。
4. 建账月中，旧系统的每笔已完成业务，手工同步到新idempiere系统中。
5. 建账月末，两套系统试算，并比较数据是否正确。
6. 关闭旧系统，启动新系统。
7. 新系统的往来模块包含“未完成单据明细”，可产生往来账龄。但无“已完成单据”，无法查询历史交易记录。
8. 新系统的库存模块包含“当月出入库单据”，出入成本依“标准成本”和“实际成本”定义，需要建账月末对库存重新估值。

![建账数据示意图](http://static.oschina.net/uploads/space/2016/0524/165235_yzes_2720480.png)

![未完成往来单据](http://static.oschina.net/uploads/space/2016/0612/190345_0JP7_2720480.png)

建账准备
---

除了[基础资料@](http://idempiere_guide_fi.mydoc.io?v=${version}&t=79149)  和[会计规则@](http://idempiere_guide_fi.mydoc.io?v=${version}&t=79148) ，从财务业务模块来看，建账还需要如下信息：
- 总账
    - 账务权限（审批流程、审计要求等）
    - 计提方案（账户分配定义）
    - 周期性账务（凭证模版）
    - 基础数据（单据类型、单据编号、税率、汇率）

- 应收
    - 客户、销售代理
    - 客户余额
    - 付款条款、单据类型
    - 合同：
可选。如果每笔交易都有合同，导入合同将保证业务数据的完整性。
      - 客户未完货合同
      - 客户未完票合同
    - 发票：
必选，应收账龄由此产生。未完成发票的按客户依次新建或者导入，发票金额只计未完成（未收）金额，所有未完成发票总额等于应收账款余额。且不计相关税额，税额一并计入发票总额，记账日期按照开票日期起算。使用“临时AR费用”而不是产品来登记。记账分录为“借 应收账款；贷 临时AR期初”。
      - 客户"已开票未完款"的发票（应收账款）
      - 客户"已开税务发票未完款"的发票（税额可能已缴）
    - 收款：
必须。未分配发票的收款（预收款或者多次回款）按客户依次新建或者导入。如果银行已对账，使用“临时结算银行”登记，不要使用任何“费用”来记录，否则将分配收款。收款单的分录为“借 资金在途；贷 未分配收款”。导入完成后，在不同的银行之间核销“已对账收款”和“在途收款”。
      - 客户发票付款进度表（发票分配付款信息）
      - 客户预付款到账信息表

- 应付
    - 供应商、采购代理
    - 供应商余额
    - 付款条款、单据类型
    - 合同：
同应收合同。
    - 发票：
同应收发票，必选，应付账龄数据来源。未完成发票的按供应商依次新建或者导入，发票金额只计未完成（未付）金额，所有未完成发票总额等于应付账款余额。且不计相关税额，税额一并计入发票总额，记账日期按照开票日期起算。使用“临时AP费用”而不是产品来登记。记账分录为“借 临时AP期初；贷 应付账款”。使用“贷记通知单”保证供应商未清余额的正确性。
      - 供应商"已开票未完款"的发票（应付账款）
      - 供应商"已开税务发票未完款"的发票（进项税基数）
    - 付款：
必须。未选择发票的付款（预付款或者多次付款）按供应商依次新建或者导入。如果银行已对账，使用“临时结算银行”登记，否则使用正确的银行。付款单的分录为“借 未选择付款；贷 资金在途”。导入完成后，在不同的银行之间核销“已对账付款”和“在途付款”。
      - 供应商发票付款进度表（发票分配付款信息）
      - 供应商预付款+应付账款
      - 供应商发票坏账计提表
      - 供应商账龄表
      - 代理佣金付款进度表
- 出纳
    - 客户已付银行未到账
    - 客户已付票据/支票清单

- 资产

- 成本

- 预算

- 报表


以下为两种建账场景：**初次建账**和**系统迁移**。

初次建账
---

1. 整理暂估入库。（产品资产、应收账款-未开票）（合同和入库单一并收集，等来票后匹配）
2. 导入期初余额表并核销临时科目。
  - 非单据控制科目，用总账批导入。
  - 单据控制科目，用临时科目替代后导入，比如AR应收临时、AR应收临时、存货资产临时。
  - AP临时科目核销。准备好所有供应商，做假合同核销该科目。
  - AR临时科目核销。准备好所有客户，做假合同核销该科目。
  - 存货临时科目核销。做一个实物盘点（physical inventory count），差异金额用凭证新建到“存货成本科目”（Inventory Clearing）
3. 导入未完成的AR发票，使用“费用临时1”，只输入未收金额。
4. 导入未分配发票或者预收款的AR收款单。
5. 导入未完成的AP发票，使用“费用临时2”，只输入未付金额。
6. 导入未选择发票或者预付款的AP付款单。
7. 导入银行未到账的已分配发票AR收款或者已选择发票的AP付款，分配付款到“费用”而不是发票。
8. 初始化银行期初余额。做银行对账单，核销所有已结算的“未分配发票收款”“预收款”和“预付款”。
9. 做库存盘点并估值。
10. 试算余额表，并检查。

步骤 | 初始化事项 | 分录 | 
---|---|---|
暂估入库 |  |  | 
试算平衡 | 单据：GL patch，凭证批 |  | 
未完成AR发票 | 单据：AR发票
对象：Opening Charge AR 费用临时1
金额：未付金额，税额并入总额 | 借 应收账款
贷 临时AR期初 | 
未分配的AR收款 | 单据：AR收款
对象：不能是费用对象，否则将被分配
金额：按实际
核销：已到账入实际银行帐号，未到账入“临时银行帐号” | 借 资金在途
贷 未分配收款 | 
未完成的AP发票 | 单据：AP发票
对象：Opening Charge AP 费用临时2
金额：未付金额，税额并入总额 | 借 临时AP期初
贷 应付账款 | 
未选择的AP付款 | 单据：AP付款
对象：不能是费用对象，否则将被分配
金额：按实际
核销：已到账入实际银行帐号，未到账入“临时银行帐号” | 借 未选择付款
贷 资金在途 | 
已确认的收付款 | 单据：AR收款
对象：Opening AR Charge 费用临时3
金额：按实际
核销：已到账入实际银行帐号，未到账入“临时银行帐号”

单据：AP付款
对象：Opening AP Charge 费用临时4
金额：按实际
核销：已到账入实际银行帐号，未到账入“临时银行帐号” | AR收款
借 资金在途
贷 临时AR期初

AP付款
借 临时AP期初
贷 资金在途 | 
银行核销 | 单据：银行对账单
对象：银行，已结算的支付款
金额：核销后银行开帐期初正确 |  | 
库存估值 |  |  | 
试算平衡 |  |  | 

成本数据
---

id使用标准成本，新系统如何导入标准成本呢？
1. 新建产品，在产品-价格页签下新建价格表记录
2. 新建采购订单，导入所有产品明细和数量，每个明细的cost price字段填入当前标准成本。
3. 保存，过账。(产品成本信息无更新)
4. 新建入库单，对刚才的采购订单入库，过账。
5. 检查该产品成本记录，标准成本为cost price。

(如果不填入订单cost price价格，只填采购价格，入库单过账时会报错“无成本记录“，但再次过账才会成功。这时，产品的标准成本=采购单价。)

注：不要使用导入库存功能导入成本数据。
https://groups.google.com/forum/#!msg/idempiere/vy0LUFV3e8g/2XGp5dk_BZAJ

oracle开帐

```
本来觉得挺简单的问题，经各位这么一说，觉得还真挺复杂。呵。
谈一点个人的想法：
1、与供应商、客户有关的，最好在AP/AR，录入，视同录入发票或者预付款；否则在子模组查看供应商、客户的往来就会不正确；
     传到总帐的凭证，尽量不要删除，这样在客制往来报表的时候，往来信息会有用处；
2、库存余额，最好是能导入则导入，一般企业的Item非常多；当然也可以以杂收的方式录入系统，传到GL的凭证删除即可；
3、如果上了现金模块，银行现金余额最好在模块中录入；导入GL的凭证也可不删除；
4、应付款暂估，即已入库未开发票的材料，需要列出明细，在PO中补录订单及接收，入库。导入总帐后凭证删除，并根据科目余额，GL直接做一笔分录调整；到月初再冲回；
      当然如果这个应付款明细汇总正好等于应付款暂估的余额最好－－一般企业整理出来的数据，都会比较乱，：）
5、最好设一个中转科目：比如期初开帐，用来做平衡；比如：录现金余额时：Dr：现金，Cr：期初开帐；－－－期初开帐到最后，肯定是借－贷＝零；

一点拙见，请各位指正；谢谢！
```

以前的开账笔记

```
一、开帐步骤：
    1、选择一个【期初/期末】日期。（最好在年初调整完上年事务后，并行时间看业务复杂程度）

    2、新建中转科目--【AR结算AR Clearing】【AP结算AP Clearing】【银行结算Bank Clearing】【库存结算Inventory Clearing】
         备注：1、设置属性为资产负债表账户，借贷均可。2、银行相关默认科目也要设置好。

    3、新建2个新费用--【AR期初费用】【AP期初费用】，并对应相应科目为【AR结算AR Clearing】，【AP结算AP Clearing】。
         备注：1、费用用于和产品无关的支出和收入，不需要账龄分析的，比如房租、运费、工资等。2、不含税。

    4、备份数据库，并导入基础信息（BP，Products，Charge，Cost，Tax，Bank）

    5、导入数据：
        5.1、未匹配材料：针对已收货的物料（暂估入库材料），后续发生的会计业务会影响科目期初余额，需输入新系统并过账。
                如果应付款暂估余额等于应付款期初余额（5.2的AP暂估），则无需调平。否则删掉凭证，重做暂估分录。
          备注：1、未开票或者票未到的，导入采购订单。（采购过账，无分录）
                    2、已开票的，不管收到没有，导入发票。
                    3、到票已付款的，导入付款。

        5.2、科目期初余额：所有末级科目的余额。导入到GL Batch方便以后管理。此法无法跟踪未关闭的业务单据，且不应用于单据控制科目。
                如果想跟踪，如下科目可以这样处理：
		AP         	--&gt;	AP结算 （包含所有AP科目和所有未核销的AP支出，如果未核销AP支出已记入银行期初余额，则先从该余额中扣去。）
		AR         	--&gt;	AR结算 （包含所有AR科目和所有未核销的AR收入，如果未核销AR收入已记入银行期初余额，则先从该余额中扣去。）
		Inventory	--&gt;	Inventory结算 （实物库存金额）
		Bank        	--&gt;	Bank结算（所有已核销的往来，包括：未分配的AR收入，未清AP支出。）

        5.3、未清AR待开发票：销售部整理所有“待开”给客户的发票明细。财务部核对所有 AR暂估 科目的所有未开发票明细。
          备注：一行对应一个客户发票。只需要导入总额（未付），发票对应【AR期初费用Opening Charge AR】
        5.4、未分配AR待收：销售部整理所有客户的未分配收款，财务部核对旧系统AP下的已收科目（客户核算科目余额为正）。
          备注：所有客户的已收明细，且银行已清，不要对应费用。

        5.5、未清AP待收发票：采购部整理所有供应商“未开”的发票明细。财务核对所有 AP暂估 科目的所有未开发票明细。
          备注： 一行对应一个供应商发票。只需要导入总额（未付），发票对应【AP期初费用Opening Charge AR】
        5.6、未清AP待付：采购部整理每个供应商的未分配付款，财务部核对旧系统下AP下的预付科目（多给供应商的钱）。
          备注：所有供应商的已付明细，且银行已清，不要对应费用。

        5.7、未核销往来款：财务部整理银行未清的已分配往来款项，记入相应暂估费用（未分配的由上面3456完成）
          备注：凭证分录最后如下：
                     AR应收：借Debit：  银行在途                            				贷Credit：【AR期初费用Opening Charge AR】
                     AP应付：借Debit：【AP期初费用Opening Charge AP】        	贷Credit：  银行在途

        5.8、库存估值：一个含成本的产品的清单，按库位排序。
        5.9、固定资产：略。
        5.10、所有单据已经输入，总账科目借贷平衡。
        	5.10.1 银行核销：依次对所有银行已核对的往来款，进行核销。这样银行的在途金额和余额完全正确。
        	5.10.2 报表检查：试算平衡表，账龄报表，存货估值表，资产负债表，银行对账单

二、导入清单：
    1、Unmatched Material		导入PO等
    2、Opening Trial Balance		导入日记账批GL Journal Batch。
    3、Open AR Invoices			导入Invoice (Customer)
    4、Unallocated AR Receipts	导入付款Payment(AR Receipt)
    5、Open AP Invoices			导入Invoice (Vendor)
    6、Open AP Payments		导入付款Payment(AP Payment)
    7、Unreconciled Payments		导入付款Payment（选择相应的【AR期初费用】or【AP期初费用】）除了5和6的付款。
    8、Inventory Valuation		导入库存Import Inventory

三、案例
    1、简单期初数据案例（待审核）
========
现金   1000
银行   4000
库存   2000

应收AR   
应收账款 2000  客户A--发票已开--SO1--未付款
预收账款 1000  客户B--发票未开--SO2--已付款
------------------
应付AP
应付账款 1500  供应商A--发票已开--PO1--已到货--未付款
预付账款   500  供应商B--发票未开--PO2--未到货--已付款
预付账款   500  供应商C--发票未开--PO3--已到货--已付款

实收资本：7000
未分配利润：500
========end

    2、复杂期初数据案例（待完成）
```

