银行业务
===

银行业务包括：
1. 新建银行/账户
2. 账户初始化
3. 设置对账加载器和匹配器
4. 导入对账单，并过账
5. 银行转账
6. 做类似“银行对账余额调节表”之类的info window，也可以做总账核销银行过渡账户（清账）
7. 银行报表

可参考插件：http://wiki.idempiere.org/en/Plugin:_Bank_Statement_Matching

银行转账
---

选择2个银行，选择一个费用。
选择转账业务发生的组织。
系统生成2个支付单据，一个AP，一个AR。
对于AP单据，新建一个银行对账单，导入AP数据，（如发生费用，费用填入负数），过账。
对于AR单据，新建一个银行对账单，导入AR数据，（如果是外币，自动变入帐银行货种），过账。

![外币转账](https://static.oschina.net/uploads/space/2018/0112/194037_OVxi_2720480.png)

银行对账
---

理论上讲，企业银行日记账的记录与银行开出的“银行存款对账单”无论是发生额，还是期末余额都应该是完全一致的，因为它们是对同一账号存款的记录。但是，通过核对，我们会发现双方的账目经常出现不一致的情况。原因有两个，一是有“未达账项”;二是双方账目可能发生记录错误。

未达账项是指银行收、付款结算凭证在企业和开户银行之间传递时，由于收到凭证的时间不同而发生的有些凭证一方已经入账，而另一方尚未入账，从而造成企业银行存款日记账记录与银行对账单记录不符现象的某些账款。未达账项是银行存款收付结算业务中的正常现象，主要有以下4种情况：

一是银行已经收款入账，而企业尚未收到银行的收款通知因而未收款入账的款项，如，委托银行收款等。
二是银行已经付款入账，而企业尚未收到银行的付款通知因而末付款入账的款项，如，借款利息的扣付、托收无承付等。
三是企业已经收款入账，而银行尚未办理完转账手续因而未收款入账的款项，如，收到外单位的转账支票等。
四是企业已经付款入账，而银行尚未办理完转账手续因而未付款入账的款项，如，企业已开出支票而持票人尚未向银行提现或转账等。

出现第一和第四种情况时，会使开户单位银行存款账面余额小于银行对账单的存款余额；
出现第二种和第三种情况时，会使开户单位银行存款账面余额大于银行对账单的存款余额。

对账流程
---

1. 定义银行对账单加载器（Loader）：可定义在线接口或者csv格式
2. 导入银行对账单文件：从在线loader导入或者cvs laoder导入
3. 检查导入数据：查看对账行日期和记录数
4. 导入银行对账单：将导入表数据正式生成业务单据
5. 匹配对账单明细：匹配器写入支付单、发票、合作伙伴信息到对账单明细行
6. 完成对账单：更新银行余额和支付单对账状态。未匹配的支付单，继续等待下次匹配（或者手工匹配）
7. 生成会计分录

关键概念
---

加载器：定义银行对账单数据的在线接口定义，需要自定义java类。
导入银行对账单：使用加载器和对账单文件，将对账数据导入到“银行对账单”导入临时表，检查无误后导入。
匹配器：定义对账单明细与支付单、发票、合作伙伴的匹配逻辑，需要自定义java类。

对账截图
---

新建一个银行对账单，选择银行账户和对账日期。
如果不使用银行对账单，使用支付单来默认完全到账，点击“支付记录拷贝”按钮，将显示对账日期前的所有未对账的支付记录。
选中需要的数据，生成对账明细行。
如需新建对账明细行，可参考“对账总额 = 交易总额 + 费用总额 + 利息总额”公式。
如果先输入“对账总额”，系统自动创建等额的费用，并出现杂费选择框。
如果先输入“交易总额”，系统等你要么填入支付单或者利息总额或者杂费总额，最后保证“对账总额”为0。
建议：先输入“对账总额”，再选择“支付单”,在设置相应的“费用”（费用支出都是负数）。

![银行对账单](https://static.oschina.net/uploads/space/2018/0112/193349_fAuf_2720480.png)

![银行手续费](https://static.oschina.net/uploads/space/2018/0112/193405_R9Z2_2720480.png)

银行报表
---

1. 未对账清单：未对账的支付单明细
2. 银行账户报表：账户交易明细账

