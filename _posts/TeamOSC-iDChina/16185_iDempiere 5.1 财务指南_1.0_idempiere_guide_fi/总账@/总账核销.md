总账核销
===

概述
---

在权责记账模式（accrual accounting）中，因借贷双方发生时间各不相同，通过“暂估/结算”科目可以先记账，到了时间再对“暂估/结算”性质的科目进行核销（调整）。
典型业务：AP/AR类型、银行在途、已到货未到票、未选择付款/未分配收入。
如果该科目存在余额，则表明反向业务还没有在这个时间点发生，或者已发生但金额不匹配。
当业务比较复杂的时候，很难分辨这些余额是如何形成的，这个核销功能将能简化这个操作。

核销原理
---

对类似银行在途、未分配付款、暂估物资、已开票未付款，未分配付款等“过渡科目”的分录对账（勾稽），以查看该科目借贷余额的产生原因。

比如：某个商业伙伴应付业务发生如下分录：
开票：借 应收账款    ；  贷 主营利润
收款：借 银行在途    ；  贷 未分配收款
分配：借 未分配收款；  贷 应收账款
对账：借 银行资产    ；  贷 银行在途
\----------------------------------------
报表： 借 银行资产   ；  贷 主营利润

从上看出，如果业务完整发生，单个过渡科目必定成对发生，且“过渡科目”期末余额应该为零。
如果不为零，需要从大量分录找出哪些科目未能一一对应，使用“总账核销”可以产生“未核销分录”报告，以方便财务核对余额。
比如上例，如果“银行在途”科目余额不为零，肯定是“对账”业务没有发生。

在权责记账模式（accrual accounting）中，因借贷双方发生时间各不相同，通过“暂估/结算”科目可以先记账，到了时间再对“暂估/结算”性质的科目进行核销（调整）。
典型业务：AP/AR类型、银行在途、已到货未到票、未选择付款/未分配收入。
如果该科目存在余额，则表明反向业务还没有在这个时间点发生，或者已发生但金额不匹配。
当业务比较复杂的时候，很难分辨这些余额是如何形成的，这个核销功能将能简化这个操作。

与国内常见的在总账模块做“往来款核销”不同，该操作不是“发票”与“支付单”的核销。
对分录的核销只是在“分录核销表Fact_Reconciliation ”中添加一个标记，不改变任何余额。

系统提供：
1. 自动核销分录
2. 手动核销分录
3. 报表：未核销分录

未核销报表
---

1. 【绩效管理】-【未核销分录】
2. 选择科目和日期，运行。
3. 默认报表需要自定义下，可根据供应商分组汇总。

![](https://static.oschina.net/uploads/space/2017/0914/014842_v6KS_2720480.png)

自动核销
---

1. 【绩效管理】-【帐户核销-自动】
2. 选择科目，核销规则。（**不选择帐套，是不是所有帐套都核销了**）
3. 运行。系统产生类似于“Auto C_Payment:1011771”的核销标记。

####核销规则####
 如果自定义核销规则，可以
1. 【数据字典】-【规则】
2. 添加如下类似规则：AR/AP Trade (Receivables/Vendor Liability）

核销规则示例

```
 (CASE WHEN fa.AD_Table_ID =  318 /* C_Invoice */ 
THEN (SELECT (CASE WHEN i.DocStatus IN ('VO','RE') AND i.Reversal_ID &gt; 0 
                            THEN 'Auto C_Invoice Reversed:' || least(i.C_Invoice_ID, i.Reversal_ID)
                             WHEN i.DocStatus = 'VO'
                             THEN 'Auto C_Invoice Voided:' || i.C_Invoice_ID
                             ELSE 'Auto C_Invoice:' || fa.Record_ID END)
              FROM C_Invoice i
              WHERE i.C_Invoice_ID=fa.Record_ID)  
 WHEN fa.AD_Table_ID = 735 /* C_AllocationHdr */  
 THEN (SELECT 'Auto C_Invoice:' || al.C_Invoice_ID FROM C_AllocationLine al 
 WHERE al.C_AllocationHdr_ID = fa.Record_ID 
 AND al.C_AllocationLine_ID = fa.Line_ID ) END)
```

手动核销
---

1. 【绩效管理】-【分录核销-手动】
2. 选择帐套，点击搜索。可选科目，供应商。
3. 分录框中选择不同记账分录中的成对过渡科目，余额为零即可核销。
4. 系统在“匹配码”字段产生类似于“Manual: 用户名 2010-01-01 12:00:00.000”的核销标记。

![](https://static.oschina.net/uploads/space/2017/0914/014758_x2ZM_2720480.png)

取消核销
---

1. 【绩效管理】-【分录核销-手动】
2. 选择“已核销”标记，搜索。
3. 选择核销记录，点击“重置”。

